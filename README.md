# Family Tree Frontend

Веб-приложение для визуализации семейного древа с прикреплением мультимедиа и историй.

## Технологический стек

- **Next.js 16** (App Router)
- **React 18**
- **TypeScript**
- **Tailwind CSS**
- **TanStack Query** (React Query) - управление состоянием сервера
- **Zustand** - управление локальным состоянием
- **React Flow** - визуализация дерева
- **Radix UI** - компоненты интерфейса
- **Sonner** - уведомления
- **date-fns** - работа с датами
- **Lucide React** - иконки

## Основные возможности

### Безопасность
- Санитизация всех пользовательских вводов
- Валидация email, username, password
- Rate limiting для API запросов
- Безопасное хранение JWT токенов
- Защита от XSS через экранирование

### Функциональность
- Регистрация и авторизация пользователей
- Профиль пользователя с датой рождения, датой смерти и расчетом возраста
- Создание и управление семьями
- Визуализация генеалогического дерева с отображением возраста
- Добавление и редактирование узлов (людей) с датами и возрастом
- Создание связей между узлами
- Создание воспоминаний с медиафайлами
- Загрузка фото и видео для узлов и воспоминаний
- Поддержка Markdown в описаниях
- Поиск пользователей для приглашения в семьи

### Компоненты

#### Страницы
- `/` - главная страница
- `/login` - вход
- `/register` - регистрация
- `/dashboard` - дашборд с семьями
- `/dashboard/family/[id]` - страница семьи
- `/dashboard/family/[id]/tree` - визуализация дерева
- `/dashboard/family/[id]/memories` - воспоминания
- `/dashboard/profile` - профиль пользователя

#### Компоненты
- `MemoryViewer` - просмотр воспоминания с markdown
- `EditMemoryModal` - редактирование воспоминания с загрузкой медиа
- `NodeViewer` - просмотр узла с медиа и отображением возраста
- `NodeEditor` - редактирование узла
- `FamilyCard` - карточка семьи
- `CustomNode` - кастомный узел для дерева с отображением дат и возраста

## Установка и запуск

### Требования
- Node.js 18+
- npm или yarn

### Установка зависимостей

```bash
npm install
```

### Настройка

Создайте файл `.env.local`:

```env
NEXT_PUBLIC_API_URL=http://localhost:8000
```

### Запуск

```bash
npm run dev
```

Приложение будет доступно по адресу [http://localhost:3000](http://localhost:3000)

### Сборка для продакшена

```bash
npm run build
npm start
```

## Структура проекта

```
diplom/
├── app/                    # Next.js App Router
│   ├── (auth)/            # Группа маршрутов авторизации
│   ├── dashboard/         # Дашборд
│   └── page.tsx           # Главная страница
├── components/            # React компоненты
│   ├── ui/               # UI компоненты (Radix UI)
│   └── ...               # Бизнес-логика компоненты
├── lib/                   # Утилиты и хелперы
│   ├── api.ts            # API клиент
│   ├── security.ts       # Функции безопасности
│   └── authContext.tsx   # Контекст авторизации
├── store/                 # Zustand stores
├── types/                 # TypeScript типы
└── public/               # Статические файлы
```

## API интеграция

Все запросы к API выполняются через `lib/api.ts`:
- Автоматическая обработка ошибок
- Добавление JWT токена к запросам
- Таймауты запросов
- Обработка 401 (редирект на логин)

## Безопасность на клиенте

- Санитизация всех пользовательских вводов через `sanitizeTextField`
- Валидация email, username, password
- Rate limiting для предотвращения спама
- Безопасное отображение HTML (только через `description_html` с бэкенда)

## Медиафайлы

- Поддержка загрузки изображений (JPEG, PNG, GIF, WebP)
- Поддержка загрузки видео (MP4, WebM, OGG, MOV)
- Валидация типов файлов на клиенте
- Предпросмотр перед загрузкой
- Удаление медиафайлов

## Markdown

Описания поддерживают Markdown синтаксис:
- Заголовки
- Списки
- Выделение текста
- Ссылки
- И другие стандартные элементы Markdown

HTML рендерится безопасно на бэкенде и отображается через `dangerouslySetInnerHTML` (безопасно, так как HTML уже санитизирован на бэкенде).
